<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Soundboard (8×8)</title>
<style>
  :root{
    --bg:#0b0f12; --panel:#0f161a; --ink:#e9f6f2; --muted:#a8bdb5; --line:rgba(255,255,255,.14);
    --q0:#30f39b; --q1:#42c6ff; --q2:#ffcc66; --q3:#ff6961;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font:14px/1.35 Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:1360px;margin:0 auto;padding:12px}
  .row{display:flex;align-items:center;gap:8px;margin:8px 0}
  .spacer{flex:1}
  .label{font-weight:900;letter-spacing:.3px}
  .card{background:linear-gradient(180deg,#121a1f,#0e1418);border:1px solid var(--line);border-radius:16px;padding:12px}

  .btn{border:1px solid var(--line);background:#141c1f;color:var(--ink);padding:8px 12px;border-radius:10px;cursor:pointer}
  .btn.small{padding:6px 10px;font-size:12px}
  .btn.ghost{background:#10161a}
  .btn[aria-pressed="true"]{outline:2px solid rgba(66,198,255,.5)}
  .pill{font:11px;padding:2px 8px;border:1px solid var(--line);border-radius:999px;color:#c9ded6}
  .muted{color:var(--muted)}
  .small{font-size:12px}
  .sr-hide{display:none !important}
  .num{width:70px;padding:6px 8px;border-radius:8px;border:1px solid var(--line);background:#0f1519;color:#e9f6f2}

  /* Pads — lighter + raised/3D */
  .padgrid{display:grid;grid-template-columns:repeat(8, 1fr);gap:10px;margin-top:8px}
  .pad{
    user-select:none;touch-action:manipulation;cursor:pointer;height:78px;border-radius:16px;position:relative;overflow:hidden;
    display:flex;align-items:center;justify-content:center;text-align:center;font-weight:900;letter-spacing:.4px;
    border:1px solid rgba(255,255,255,.16);
    background: linear-gradient(180deg,#192229,#0f1519);
    box-shadow:
      0 18px 28px rgba(0,0,0,.45),
      0 2px 0 rgba(255,255,255,.09) inset,
      0 -14px 26px rgba(0,0,0,.34) inset;
    padding:6px; outline:none; filter:saturate(1.25) brightness(1.08);
  }
  .pad::before{
    content:""; position:absolute; inset:0; border-radius:16px; pointer-events:none;
    background:linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,0) 40%);
    mix-blend-mode:screen; opacity:.7;
  }
  .pad .sub{position:absolute;bottom:6px;left:8px;font:11px/1.1 ui-monospace,Menlo,Consolas;color:#c0d5cd;opacity:.95}
  .pad::after{content:"";position:absolute;inset:0;pointer-events:none;border-radius:16px}
  .quad0{background:linear-gradient(180deg, rgba(60,255,178,.32), rgba(60,255,178,.12) 32%, #132028 100%)}
  .quad1{background:linear-gradient(180deg, rgba(90,210,255,.34), rgba(90,210,255,.14) 32%, #132028 100%)}
  .quad2{background:linear-gradient(180deg, rgba(255,214,120,.36), rgba(255,214,120,.16) 32%, #132028 100%)}
  .quad3{background:linear-gradient(180deg, rgba(255,125,118,.38), rgba(255,125,118,.18) 32%, #132028 100%)}
  .pad.playing{transform:translateY(1px);
    box-shadow:
      0 12px 20px rgba(0,0,0,.45),
      0 2px 0 rgba(255,255,255,.10) inset,
      0 -32px 62px rgba(255,255,255,.10) inset;
    filter:saturate(1.55) brightness(1.2);
  }
  .pad.recording{outline:2px solid rgba(255,85,85,.7); box-shadow:0 0 18px rgba(255,85,85,.45), inset 0 -32px 62px rgba(255,255,255,.10);}

  /* Panels */
  .panel{margin-top:12px;display:none}
  .panel.show{display:block}

  /* Sequencer grid */
  #seqGrid{display:grid;grid-template-columns:120px repeat(16, 1fr);gap:4px}
  .track-label{display:flex;gap:6px;align-items:center;font-weight:700}
  .step{height:22px;border-radius:6px;border:1px solid var(--line);background:#121a1d;cursor:pointer;position:relative;transition:filter .12s ease, box-shadow .12s ease;}
  .step.on{box-shadow:inset 0 -10px 20px rgba(255,255,255,.07), 0 2px 6px rgba(0,0,0,.2); filter:saturate(1.3) brightness(1.05)}
  .step.cur{outline:2px solid rgba(66,198,255,.55)}
  .step.beatStart{border-left:2px solid rgba(255,255,255,.18)}
  .step.b0{background:linear-gradient(180deg, rgba(48,243,155,.12), #121a1d)}
  .step.b1{background:linear-gradient(180deg, rgba(66,198,255,.12), #121a1d)}
  .step.b2{background:linear-gradient(180deg, rgba(255,204,102,.14), #121a1d)}
  .step.b3{background:linear-gradient(180deg, rgba(255,105,97,.14), #121a1d)}

  .scene-bar{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .chainline{display:flex;gap:8px;flex-wrap:wrap;align-items:center}

  /* Rotary knobs – deeper bevel/specular */
  .knobrow{display:flex;gap:18px;align-items:flex-start;flex-wrap:wrap}
  .knob{--k:86px; width:var(--k); display:flex; flex-direction:column; align-items:center; gap:6px; user-select:none}
  .knob, .knob .k-face{ touch-action:none; overscroll-behavior:contain; }
  .knob .k-face{
    width:var(--k); height:var(--k); border-radius:50%;
    background:
      radial-gradient(130% 120% at 28% 30%, rgba(255,255,255,.36), rgba(255,255,255,.10) 42%, rgba(0,0,0,.45) 70%, rgba(0,0,0,.68)),
      conic-gradient(from 210deg at 50% 50%, rgba(255,255,255,.16), rgba(255,255,255,0) 30%, rgba(0,0,0,.4) 75%, rgba(255,255,255,.16) 95%, rgba(255,255,255,.2)),
      linear-gradient(180deg,#12181d,#0a1014);
    border:1px solid rgba(255,255,255,.25);
    box-shadow:
      inset 0 14px 28px rgba(255,255,255,.10),
      inset 0 -12px 24px rgba(0,0,0,.60),
      0 12px 30px rgba(0,0,0,.48);
    position:relative;
  }
  .knob .k-face::before{
    content:""; position:absolute; inset:10px; border-radius:50%;
    background:
      radial-gradient(60% 60% at 30% 30%, rgba(255,255,255,.25), rgba(255,255,255,0) 70%),
      conic-gradient(from 0deg, rgba(255,255,255,.08), rgba(255,255,255,0) 40%, rgba(255,255,255,.08) 60%, rgba(255,255,255,0) 100%);
    box-shadow: inset 0 0 0 2px rgba(255,255,255,.10), inset 0 26px 48px rgba(255,255,255,.08);
    pointer-events:none;
  }
  .knob .k-mark{
    position:absolute; left:50%; top:50%;
    width:3px; height:calc(50% - 12px);
    transform-origin:50% 100%;
    transform:translate(-50%, -100%) rotate(var(--ang,-150deg));
    background:linear-gradient(180deg,rgba(255,255,255,.98), rgba(255,255,255,.3));
    border-radius:2px; box-shadow:0 0 10px rgba(255,255,255,.22);
  }
  .k-label{font:11px;color:var(--muted)}
  .k-val{font:11px;font-family:ui-monospace,Menlo,Consolas;color:#bfe1d7}
  .fx-knobs{display:flex; gap:22px; flex-wrap:wrap; align-items:flex-start}

  /* Kit editor layout */
  .kit-grid{display:grid;grid-template-columns:34px 140px 1fr;gap:6px;margin-top:8px}
  .kit-row{display:grid;grid-template-columns:34px 140px 1fr;gap:6px;align-items:center;padding:6px 6px;border-bottom:1px solid var(--line)}
  .kit-head{font-size:12px;color:#c9ded6;opacity:.9;padding:4px 0;border-bottom:1px solid var(--line)}
  .namecell{display:flex;flex-direction:column;gap:6px}
  .namecell input[type="text"]{width:100%;padding:6px 8px;border-radius:8px;border:1px solid var(--line);background:#0f1519;color:var(--ink)}
  .namecell .fileline{display:flex;align-items:center;gap:8px}
  .namecell .dur{font:11px;color:#a8bbb4}

  .kit-controls{
    display:grid;
    grid-template-columns: repeat(6, 54px) minmax(170px, 1fr);
    gap:6px 6px;
    align-items:start;
  }
  .kit-controls .rightcell{
    grid-column: 7;
    grid-row:1 / span 2;
    display:flex;flex-direction:column;gap:8px;align-self:stretch;justify-content:flex-start;
  }
  .kit-controls select{padding:6px 8px;border-radius:8px;border:1px solid var(--line);background:#0f1519;color:#0ffaf0}
  .rightcell label{font:12px/1.2 Inter,ui-sans-serif;color:#cfe2db;display:flex;flex-direction:column;gap:4px}
  .rightcell .checks{display:flex;flex-direction:column;gap:4px}
  .rightcell .checks label{flex-direction:row;align-items:center;gap:6px}

  .vcol{display:flex;flex-direction:column;align-items:center;gap:6px;width:54px}
  .vlabel{font:11px;color:#cfe2db}
  .vval{font:11px;color:#bfe1d7;font-family:ui-monospace,Menlo,Consolas;text-align:center;width:100%}

  /* Vertical slider */
  .vslider{
    --throw: 60px; --track-w: 10px; --thumb: 22px;
    width: 44px; height: var(--throw); padding:0; background:transparent; writing-mode:bt-lr;
    -webkit-appearance:slider-vertical; appearance:slider-vertical;
  }
  .vslider::-webkit-slider-runnable-track{
    width:var(--track-w); height:var(--throw); border:none;
    background:linear-gradient(180deg,#0b1115,#1b2630), radial-gradient(120% 80% at 50% 12%, rgba(255,255,255,.22), rgba(255,255,255,0) 70%);
    border-radius:7px; box-shadow: inset 0 6px 10px rgba(255,255,255,.08), inset 0 -9px 14px rgba(0,0,0,.60), 0 0 0 1px rgba(255,255,255,.22);
    margin:0 auto;
  }
  .vslider::-webkit-slider-thumb{
    -webkit-appearance:none; appearance:none;
    width:var(--thumb); height:var(--thumb);
    margin-left: calc((var(--thumb) - var(--track-w)) / -2);
    background: radial-gradient(62% 62% at 36% 32%, rgba(255,255,255,.40), rgba(255,255,255,.12) 64%, rgba(0,0,0,.52) 100%), linear-gradient(180deg,#2d3941,#0e151a);
    border:1px solid rgba(255,255,255,.30); border-radius:50%;
    box-shadow: inset 0 3px 6px rgba(255,255,255,.16), inset 0 -4px 8px rgba(0,0,0,.62), 0 4px 10px rgba(0,0,0,.48);
  }
  .vslider::-moz-range-track{
    width:var(--track-w); height:var(--throw);
    background:linear-gradient(180deg,#0b1115,#1b2630), radial-gradient(120% 80% at 50% 12%, rgba(255,255,255,.22), rgba(255,255,255,0) 70%);
    border-radius:7px; box-shadow: inset 0 6px 10px rgba(255,255,255,.08), inset 0 -9px 14px rgba(0,0,0,.60), 0 0 0 1px rgba(255,255,255,.22);
  }
  .vslider::-moz-range-thumb{
    width:var(--thumb); height:var(--thumb);
    background: radial-gradient(62% 62% at 36% 32%, rgba(255,255,255,.40), rgba(255,255,255,.12) 64%, rgba(0,0,0,.52) 100%), linear-gradient(180deg,#2d3941,#0e151a);
    border:1px solid rgba(255,255,255,.30); border-radius:50%;
    box-shadow: inset 0 3px 6px rgba(255,255,255,.16), inset 0 -4px 8px rgba(0,0,0,.62), 0 4px 10px rgba(0,0,0,.48);
  }

  /* Sampler */
  #samplerDrop{border:1px dashed rgba(255,255,255,.25); border-radius:12px; padding:12px; text-align:center; color:#cfe2db; background:#10161a}
  #samplerWave{width:100%; height:160px; background:#0f1519; border:1px solid var(--line); border-radius:10px; display:block}
  .sampler-row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .range{display:flex; align-items:center; gap:6px}
  .range input[type=range]{width:180px}

  /* Sampler piano */
  .piano{position:relative; height:120px; padding:6px; background:#0f1519; border:1px solid var(--line); border-radius:10px; margin-top:8px; user-select:none}
  .piano .white-keys{display:flex; height:100%; gap:2px}
  .piano .key{touch-action:manipulation; cursor:pointer; user-select:none}
  .piano .key.white{flex:1; height:100%; background:linear-gradient(180deg,#f6f8f9,#d7e4e0); border:1px solid var(--line); border-radius:6px; position:relative}
  .piano .key.black{position:absolute; width:calc((100% / 14) * 0.6); height:65%; top:0; background:linear-gradient(180deg,#0a0f12,#1a2228); border:1px solid var(--line); border-radius:6px; z-index:2; transform:translateX(-50%)}
  .piano .key.active{filter:saturate(1.35) brightness(1.12); box-shadow:inset 0 -18px 40px rgba(0,0,0,.22)}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="row">
        <div class="label">Soundboard (8×8)</div>
        <span class="spacer"></span>
        <button class="btn small" id="stopAllBtn">Stop All</button>
        <button class="btn small" id="editKitBtn">Kit Editor</button>
        <button class="btn small" id="toggleSeqBtn">Sequencer</button>
        <button class="btn small" id="toggleMidiBtn">MIDI</button>
        <button class="btn small" id="toggleFxBtn">FX</button>
        <button class="btn small" id="toggleSamplerBtn">Sampler</button>
        <button class="btn small" id="toggleKitMgrBtn">Kits</button>
        <span class="pill" id="status">ready</span>
      </div>

      <!-- Pads -->
      <div id="padgrid" class="padgrid"></div>

      <!-- Kit Editor -->
      <div id="kitEditor" class="panel">
        <div class="row">
          <div class="label">Kit Editor</div>
          <span class="spacer"></span>
          <button class="btn small" id="saveKitBtn">Export .json</button>
          <button class="btn small" id="loadKitBtn">Import .json</button>
          <input type="file" id="loadKitFile" accept=".json" hidden>
        </div>

        <div class="kit-grid">
          <div class="kit-head">#</div>
          <div class="kit-head">Name / Sample</div>
          <div class="kit-head">Controls</div>
        </div>
        <div id="kitRows"></div>
      </div>

      <!-- Sequencer -->
      <div id="seqPanel" class="panel">
        <div class="row" style="align-items:flex-start;gap:16px;flex-wrap:wrap">
          <button class="btn small" id="seqPlayBtn" aria-pressed="false">Play</button>
          <input class="sr-hide" type="range" id="seqBPM"        min="50" max="300" value="120">
          <input class="sr-hide" type="range" id="seqSwing"      min="50" max="75"  value="50">
          <input class="sr-hide" type="range" id="seqSteps"      min="8"  max="32"  value="16">
          <input class="sr-hide" type="range" id="seqLookAhead"  min="5"  max="100" value="25">
          <div class="knobrow">
            <div class="knob" data-for="seqBPM"       data-min="50" data-max="300" data-step="1"    data-label="BPM"></div>
            <input id="seqBPMNum" class="num" type="number" min="50" max="300" step="1" value="120" title="BPM">
            <div class="knob" data-for="seqSwing"     data-min="50" data-max="75"  data-step="1"    data-label="Swing"></div>
            <div class="knob" data-for="seqSteps"     data-min="8"  data-max="32"  data-step="1"    data-label="Steps"></div>
            <div class="knob" data-for="seqLookAhead" data-min="5"  data-max="100" data-step="1"    data-label="Look-ahead"></div>
          </div>
          <div class="seg" role="group" aria-label="Quant">
            <button class="btn small" id="q16" aria-pressed="true">1/16</button>
            <button class="btn small" id="q8t" aria-pressed="false">1/8T</button>
          </div>
          <span class="pill" id="seqStatus">stopped</span>
        </div>
        <div id="seqGrid"></div>
        <div class="scene-bar">
          <div class="muted">Scenes:</div>
          <button class="btn small" data-scene="1">A1</button>
          <button class="btn small" data-scene="2">A2</button>
          <button class="btn small" data-scene="3">A3</button>
          <button class="btn small" data-scene="4">A4</button>
          <button class="btn small" data-scene="5">B1</button>
          <button class="btn small" data-scene="6">B2</button>
          <button class="btn small" data-scene="7">B3</button>
          <button class="btn small" data-scene="8">B4</button>
          <span class="spacer"></span>
          <button class="btn small" id="songModeBtn" aria-pressed="false">Song Mode</button>
          <button class="btn small" id="chainEditBtn" aria-pressed="false">Chain Edit</button>
          <button class="btn small" id="chainClearBtn">Clear Chain</button>
        </div>
        <div class="chainline small">
          <span class="muted">Chain:</span>
          <span id="chainView" class="muted">—</span>
        </div>
      </div>

      <!-- MIDI -->
      <div id="midiPanel" class="panel">
        <div class="row"><div class="label">MIDI</div></div>
        <div>Enable MIDI <button class="btn small" id="midiEnableBtn">Enable</button> <span class="muted" id="midiLabel">off</span></div>
        <div class="muted" style="margin-top:6px">Default: notes 36–99 → pads 1–64. Velocity scales pad gain.</div>
        <div style="margin-top:6px">MIDI Learn <button class="btn small" id="midiLearnBtn" aria-pressed="false">Learn</button> <span class="muted">Click a control, then move a knob.</span></div>
      </div>

      <!-- FX -->
      <div id="fxPanel" class="panel">
        <div class="row"><div class="label">FX & Master</div></div>
        <input class="sr-hide" type="range" id="fxDelayTime"   min="0" max="1"    step="0.001" value="0.25">
        <input class="sr-hide" type="range" id="fxDelayFB"     min="0" max="0.95" step="0.01"  value="0.35">
        <input class="sr-hide" type="range" id="fxDelayMix"    min="0" max="1.5"  step="0.01"  value="1">
        <input class="sr-hide" type="range" id="fxReverbMix"   min="0" max="1"    step="0.01"  value="0.2">
        <input class="sr-hide" type="range" id="fxReverbDecay" min="0.5" max="4"  step="0.1"   value="2.5">
        <input class="sr-hide" type="range" id="fxMasterGain"  min="0" max="1.5"  step="0.01"  value="1">
        <div class="fx-knobs">
          <div class="knob" data-for="fxDelayTime"   data-min="0"   data-max="1"    data-step="0.001" data-label="Delay Time"></div>
          <div class="knob" data-for="fxDelayFB"     data-min="0"   data-max="0.95" data-step="0.01"  data-label="Delay FB"></div>
          <div class="knob" data-for="fxDelayMix"    data-min="0"   data-max="1.5"  data-step="0.01"  data-label="Delay Mix"></div>
          <div class="knob" data-for="fxReverbMix"   data-min="0"   data-max="1"    data-step="0.01"  data-label="Reverb Mix"></div>
          <div class="knob" data-for="fxReverbDecay" data-min="0.5" data-max="4"    data-step="0.1"   data-label="Rev Decay"></div>
          <div class="knob" data-for="fxMasterGain"  data-min="0"   data-max="1.5"  data-step="0.01"  data-label="Master"></div>
          <div style="display:flex;flex-direction:column;gap:10px;align-items:flex-start">
            <button class="btn small" id="recordBtn" aria-pressed="false">Record Master</button>
            <span class="muted" id="recStatus">idle</span>
          </div>
        </div>
      </div>

      <!-- Sampler -->
      <div id="samplerPanel" class="panel">
        <div class="row"><div class="label">Sampler</div></div>
        <div id="samplerDrop">Drop audio here or <label class="btn small ghost" for="samplerFile">Choose file</label><input id="samplerFile" type="file" accept="audio/*" hidden></div>
        <canvas id="samplerWave" width="1200" height="160"></canvas>
        <div class="sampler-row">
          <button class="btn small" id="samplerPlay">Play</button>
          <button class="btn small" id="samplerStop">Stop</button>
          <button class="btn small" id="samplerOneShotRec">One-shot Rec</button>
          <button class="btn small" id="samplerLive">Live Sample</button>
          <button class="btn small" id="samplerClear">Clear</button>
          <button class="btn small" id="samplerExportSel">Export WAV (Sel)</button>
          <button class="btn small" id="samplerExportAll">Export WAV (All)</button>
          <div class="range small">Zoom <input type="range" id="samplerZoom" min="1" max="16" step="1" value="1"></div>
          <span class="small">Start: <span id="sStart">0.00s</span></span>
          <span class="small">End: <span id="sEnd">0.00s</span></span>
          <label class="small"><input type="checkbox" id="sNormalize"> Normalize</label>
          <span class="spacer"></span>
          <label class="small">Assign to pad:
            <select id="samplerPad"></select>
          </label>
          <button class="btn small" id="samplerAssign">Assign Selection</button>
          <button class="btn small" id="samplerSliceRow">Slice ×8 to Row</button>
        </div>

        <div class="sampler-row">
          <button class="btn small" id="octDown">Octave −</button>
          <span class="small muted">Octave: <span id="octLabel">C3–C5</span></span>
          <button class="btn small" id="octUp">Octave +</button>
          <span class="spacer"></span>
          <button class="btn small" id="sampModeBtn" aria-pressed="true">One-shot</button>
        </div>

        <!-- New: keyboard layers -->
        <div class="sampler-row small">
          <span>Layers:</span>
          <span id="layerList" class="muted">—</span>
          <span class="spacer"></span>
          <button class="btn small" id="layerModeBtn" aria-pressed="true">Multi-Layers On</button>
          <button class="btn small" id="layerClearWin">Clear Current Window</button>
          <button class="btn small" id="layerClearAll">Clear All</button>
        </div>

        <div id="samplerKeys" class="piano">
          <div class="white-keys"></div>
        </div>

      </div>

      <!-- Kit Manager -->
      <div id="kitMgrPanel" class="panel">
        <div class="row">
          <div class="label">Kits</div>
          <span class="spacer"></span>
          <input id="kitName" placeholder="Kit name" class="small" style="padding:6px 8px;border-radius:8px;border:1px solid var(--line);background:#0f1519;color:#e9f6f2;width:220px">
          <button class="btn small" id="kitSaveAs">Save As</button>
          <button class="btn small" id="kitExport">Export</button>
          <button class="btn small" id="kitImportBtn">Import</button>
          <input type="file" id="kitImportFile" accept=".json" hidden>
        </div>
        <div class="small muted" style="margin:4px 0 10px">Local library stored in your browser. Click a kit to load. Export/Import includes <strong>patterns</strong> and <strong>chain</strong>.</div>
        <div id="kitList" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px"></div>
      </div>

    </div>
  </div>

  <script src="js/soundboard.js" defer></script>
</body>
</html>
